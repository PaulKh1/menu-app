import streamlit as st
import pandas as pd

# –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –º–µ–Ω—é –∑ Excel
menu = pd.read_excel('–•–∞—Ä—á—É–≤–∞–Ω–Ω—è.xlsx')
menu.dropna(inplace=True)

# –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –¥–æ–¥–∞—Ç–∫—É Streamlit
st.title('üìù –Ü–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–µ –º–µ–Ω—é —Ö–∞—Ä—á—É–≤–∞–Ω–Ω—è –Ω–∞ —Ç–∏–∂–¥–µ–Ω—å')

# –í–∏–±—ñ—Ä –¥–Ω—è —Ç–∏–∂–Ω—è
day = st.selectbox('–û–±–µ—Ä–∏ –¥–µ–Ω—å —Ç–∏–∂–Ω—è:', menu['–î–Ω—ñ'].unique())

# –í–∏–±—ñ—Ä —Ç–∏–ø—É –ø—Ä–∏–π–æ–º—É —ó–∂—ñ
meal_time = st.selectbox('–¢–∏–ø –ø—Ä–∏–π–æ–º—É —ó–∂—ñ:', ['–í—Å—ñ'] + list(menu['–ß–∞—Å –ø—Ä–∏–π–æ–º—É —ó–∂—ñ'].unique()))

# –§—ñ–ª—å—Ç—Ä–∞—Ü—ñ—è –∑–∞ –¥–Ω–µ–º —ñ —Ç–∏–ø–æ–º –ø—Ä–∏–π–æ–º—É —ó–∂—ñ
filtered_menu = menu[menu['–î–Ω—ñ'].str.lower() == day.lower()]
if meal_time != '–í—Å—ñ':
    filtered_menu = filtered_menu[filtered_menu['–ß–∞—Å –ø—Ä–∏–π–æ–º—É —ó–∂—ñ'] == meal_time]

# –í—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è –º–µ–Ω—é
st.subheader(f'üçΩÔ∏è –ú–µ–Ω—é –Ω–∞ {day}')
st.dataframe(filtered_menu[['–ß–∞—Å –ø—Ä–∏–π–æ–º—É —ó–∂—ñ', '–°—Ç—Ä–∞–≤–∞ (—Ä–µ—Ü–µ–ø—Ç, –∫–∞–ª–æ—Ä—ñ—ó, —Ç–µ—Ö–∫–∞—Ä—Ç–∞)', '–ü–æ—Ä—Ü—ñ—è –¥–ª—è —á–æ–ª–æ–≤—ñ–∫–∞', '–ü–æ—Ä—Ü—ñ—è –¥–ª—è –¥—Ä—É–∂–∏–Ω–∏']])

# –†–µ–¥–∞–≥—É–≤–∞–Ω–Ω—è –º–µ–Ω—é
st.subheader('‚úèÔ∏è –†–µ–¥–∞–≥—É–≤–∞—Ç–∏ –º–µ–Ω—é')
edited_menu = st.data_editor(filtered_menu)

# –ì—Ä–∞—Ñ—ñ–∫ –∫–∞–ª–æ—Ä—ñ–π–Ω–æ—Å—Ç—ñ
st.subheader('üìä –ö–∞–ª–æ—Ä—ñ–π–Ω—ñ—Å—Ç—å —Å—Ç—Ä–∞–≤')
# –§—É–Ω–∫—Ü—ñ—è –¥–ª—è –≤–∏—Ç—è–≥—É–≤–∞–Ω–Ω—è –∫–∞–ª–æ—Ä—ñ–π –∑ —Ç–µ–∫—Å—Ç—É
def extract_calories(text):
    import re
    matches = re.findall(r'(\d+)\s?–∫–∫–∞–ª', text)
    return sum(map(int, matches)) if matches else 0

# –ü—ñ–¥—Ä–∞—Ö—É–Ω–æ–∫ –∫–∞–ª–æ—Ä—ñ–π –¥–ª—è –ü–∞–≤–ª–∞ —Ç–∞ –ù–∞—Ç–∞–ª—ñ
filtered_menu['–ö–∞–ª–æ—Ä—ñ—ó (–ü–∞–≤–ª–æ)'] = filtered_menu['–°—Ç—Ä–∞–≤–∞ (—Ä–µ—Ü–µ–ø—Ç, –∫–∞–ª–æ—Ä—ñ—ó, —Ç–µ—Ö–∫–∞—Ä—Ç–∞)'].apply(extract_calories)
filtered_menu['–ö–∞–ª–æ—Ä—ñ—ó (–ù–∞—Ç–∞–ª—è)'] = (filtered_menu['–ö–∞–ª–æ—Ä—ñ—ó (–ü–∞–≤–ª–æ)'] * 0.8).astype(int)

# –í—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è –º–µ–Ω—é –∑ –∫–∞–ª–æ—Ä—ñ—è–º–∏
st.dataframe(filtered_menu[['–ß–∞—Å –ø—Ä–∏–π–æ–º—É —ó–∂—ñ', '–°—Ç—Ä–∞–≤–∞ (—Ä–µ—Ü–µ–ø—Ç, –∫–∞–ª–æ—Ä—ñ—ó, —Ç–µ—Ö–∫–∞—Ä—Ç–∞)', '–ö–∞–ª–æ—Ä—ñ—ó (–ü–∞–≤–ª–æ)', '–ö–∞–ª–æ—Ä—ñ—ó (–ù–∞—Ç–∞–ª—è)']])

# –ì—Ä–∞—Ñ—ñ–∫ –¥–ª—è –ü–∞–≤–ª–∞
st.subheader('üìä –ö–∞–ª–æ—Ä—ñ–π–Ω—ñ—Å—Ç—å —Å—Ç—Ä–∞–≤ (–ü–∞–≤–ª–æ)')
st.bar_chart(filtered_menu.set_index('–ß–∞—Å –ø—Ä–∏–π–æ–º—É —ó–∂—ñ')['–ö–∞–ª–æ—Ä—ñ—ó (–ü–∞–≤–ª–æ)'])

# –ì—Ä–∞—Ñ—ñ–∫ –¥–ª—è –ù–∞—Ç–∞–ª—ñ
st.subheader('üìä –ö–∞–ª–æ—Ä—ñ–π–Ω—ñ—Å—Ç—å —Å—Ç—Ä–∞–≤ (–ù–∞—Ç–∞–ª—è)')
st.bar_chart(filtered_menu.set_index('–ß–∞—Å –ø—Ä–∏–π–æ–º—É —ó–∂—ñ')['–ö–∞–ª–æ—Ä—ñ—ó (–ù–∞—Ç–∞–ª—è)'])

